Bootstrap: docker
From: nvidia/cuda:11.8.0-cudnn8-devel-ubuntu22.04

%post
    # 基本パッケージのインストール
    apt-get update && apt-get install -y \
        python3 \
        python3-pip \
        python3-dev \
        git \
        wget \
        curl \
        vim \
        && rm -rf /var/lib/apt/lists/*

    # pipのアップグレード
    python3 -m pip install --upgrade pip

    # PyTorchのインストール（CUDA 11.8対応）
    pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

    # requirements.txtに記載されたパッケージのインストール
    pip3 install \
        "transformers>=4.28.1" \
        datasets==3.6.0 \
        sentencepiece \
        accelerate \
        wandb \
        ptflops \
        gradio \
        "rouge-score>=0.0.4" \
        jsonlines \
        numexpr \
        "sacrebleu==1.5.0" \
        "scikit-learn>=0.24.1" \
        sqlitedict \
        importlib-resources \
        pycountry \
        omegaconf \
        pytablewriter

%environment
    export LC_ALL=C
    export PYTHONPATH=/usr/local/lib/python3.10/dist-packages:$PYTHONPATH
    export PATH=/usr/local/bin:$PATH

%runscript
    exec python3 "$@"

%labels
    Author your_name@example.com
    Version v1.0
    Description PyTorch NLP environment with transformers and evaluation tools

%help
    このコンテナはPyTorchとTransformersを使用した自然言語処理環境を提供します。
    
    使用例:
    - Pythonスクリプトの実行: singularity run pytorch_nlp.sif script.py
    - シェルの起動: singularity shell pytorch_nlp.sif
    - 特定のコマンド実行: singularity exec pytorch_nlp.sif python3 -c "import torch; print(torch.__version__)"
